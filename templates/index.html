<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareBridge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .transition-all {
            transition: all 0.3s ease;
        }
    </style>
</head>

<body class="bg-white min-h-screen flex justify-center items-center p-6 text-zinc-900">

<div class="max-w-md w-full">

    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold">Sahayata Setu</h1>
        <p class="text-xs text-zinc-500 tracking-widest uppercase">Healthcare Support Interface</p>
    </div>

    <div class="border border-zinc-200 p-8 rounded-2xl shadow">

        <form id="supportForm" class="space-y-6">

            <div>
                <label class="text-xs font-bold text-zinc-500 uppercase">Select Role</label>
                <select id="role" onchange="toggleFormText()" class="w-full mt-2 p-3 rounded-lg bg-zinc-50">
                    <option value="Patient">Patient / Seeker</option>
                    <option value="Volunteer">Volunteer</option>
                </select>
            </div>

            <div>
                <label class="text-xs font-bold text-zinc-500 uppercase">Full Name</label>
                <input id="name" type="text" required class="w-full mt-2 p-3 rounded-lg bg-zinc-50">
            </div>

            <div>
                <label id="msgLabel" class="text-xs font-bold text-zinc-500 uppercase">
                    How can we help?
                </label>
                <textarea id="message" rows="4" required
                    class="w-full mt-2 p-3 rounded-lg bg-zinc-50 resize-none"
                    placeholder="Describe your symptoms..."></textarea>
            </div>

            <button id="submitBtn"
                class="w-full bg-black text-white py-3 rounded-lg font-bold transition-all">
                Get Help Now
            </button>

        </form>

        <div id="aiResponse" class="hidden mt-8 pt-6 border-t border-dashed">

            <div class="flex justify-between mb-4">
                <h3 id="aiTitle" class="text-sm font-bold uppercase">System Analysis</h3>
                <span class="text-xs text-zinc-400">AI-V1.0</span>
            </div>

            <div class="space-y-3 text-sm">

                <div class="flex justify-between">
                    <span id="labelCategory" class="text-zinc-500">Category</span>
                    <span id="resCategory"></span>
                </div>

                <div class="flex justify-between">
                    <span id="labelTag" class="text-zinc-500">Status</span>
                    <span id="resTag" class="border px-2 text-xs rounded"></span>
                </div>

                <div id="msgBox" class="bg-zinc-50 p-4 border-l-2 border-black italic">
                    <p id="resAutoMsg"></p>
                </div>

            </div>

        </div>

    </div>

    <p class="text-center text-xs text-zinc-400 mt-6">
        Â© 2026 Sahayata Setu Open Source
    </p>

</div>

<script>

function toggleFormText() {
    let role = document.getElementById("role").value;
    let label = document.getElementById("msgLabel");
    let msg = document.getElementById("message");
    let btn = document.getElementById("submitBtn");

    if (role === "Volunteer") {
        label.innerText = "What skills can you offer?";
        msg.placeholder = "e.g. I have a car, I can cook food";
        btn.innerText = "Register as Volunteer";
        btn.className = "w-full bg-black text-white py-3 rounded-lg font-bold";
    } else {
        label.innerText = "How can we help?";
        msg.placeholder = "Describe your symptoms or needs";
        btn.innerText = "Get Help Now";
        btn.className = "w-full bg-black text-white py-3 rounded-lg font-bold";
    }
}

document.getElementById("supportForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    let btn = document.getElementById("submitBtn");
    btn.innerText = "Processing...";
    btn.disabled = true;

    let data = {
        role: document.getElementById("role").value,
        name: document.getElementById("name").value,
        message: document.getElementById("message").value
    };

    let res = await fetch("/submit", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
    });

    let result = await res.json();

    if (result.status === "success") {
        let a = result.analysis;

        document.getElementById("aiResponse").classList.remove("hidden");
        document.getElementById("aiTitle").innerText =
            a.type === "patient_triage" ? "Triage Report" : "Skill Match";

        document.getElementById("labelCategory").innerText = a.label;
        document.getElementById("resCategory").innerText = a.category;
        document.getElementById("labelTag").innerText = a.tag_label;
        document.getElementById("resTag").innerText = a.tag_value;
        document.getElementById("resAutoMsg").innerText = a.auto_response;

        let tag = document.getElementById("resTag");

        if (a.type === "patient_triage") {
            if (a.tag_value === "High") {
                tag.className = "border border-red-500 text-red-600 px-2 rounded";
            } else if (a.tag_value === "Medium") {
                tag.className = "border border-orange-400 text-orange-500 px-2 rounded";
            } else {
                tag.className = "border border-zinc-300 text-zinc-600 px-2 rounded";
            }
        } else {
            tag.className = "border border-slate-500 text-slate-600 px-2 rounded";
        }
    }

    btn.disabled = false;
    toggleFormText();
});

</script>
</body>
</html>
